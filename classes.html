<!DOCTYPE HTML>
<html>
<head>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="mystyle.css">
<title>Manage Classes</title>
</head>

<body class="light">

<header>
    <div class="logo-container">
        <img src="logo.png" alt="School Logo" class="school-logo">
    </div>
    <h1>Class Management</h1>
    <button onclick="toggleDarkMode()" id="themeToggle">
        ðŸŒ™
    </button>
</header>

<section>
    <h3>Create New Class</h3>

    <input type="text" id="newClassName" placeholder="Class Name (e.g. 2 Mutiara)">
    <br><br>

    <input type="file" id="studentFile" accept=".csv">
    <br><br>

    <button onclick="downloadSample()">Download Name List Sample</button>
    <button onclick="createClass()">Create Class</button>
</section>

<section>
    <h3>Existing Classes</h3>
    <ul id="classList"></ul>
</section>

<section>
    <button onclick="goHome()">Back</button>
</section>

<script>

function downloadSample() {
    const sample = "name\nAli\nAisyah\nDaniel";
    const blob = new Blob([sample], { type: "text/csv" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "student_list_sample.csv";
    link.click();
}

function createClass() {
    const className = document.getElementById("newClassName").value.trim();
    const fileInput = document.getElementById("studentFile");

    if (!className || !fileInput.files[0]) {
        alert("Please enter class name and upload student list.");
        return;
    }

    const reader = new FileReader();

    reader.onload = function(e) {
        const lines = e.target.result.split("\n").slice(1);
        const students = lines.map(line => line.trim()).filter(Boolean);

        const newClass = {
            id: "c_" + Date.now(),
            name: className,
            students
        };

        const classes = JSON.parse(localStorage.getItem("classes")) || [];
        classes.push(newClass);
        localStorage.setItem("classes", JSON.stringify(classes));

        alert("Class created successfully!");
        location.reload();
    };

    reader.readAsText(fileInput.files[0]);
}

function loadClasses() {
    const classes = JSON.parse(localStorage.getItem("classes")) || [];
    const list = document.getElementById("classList");
    list.innerHTML = "";

    classes.forEach(c => {
        const li = document.createElement("li");

        li.innerHTML = `
            <strong>${c.name}</strong> (${c.students.length} students)
            <br>
            <button onclick="editClass('${c.id}')">Edit</button>
            <button onclick="deleteClass('${c.id}')">Delete</button>
            <hr>
        `;

        list.appendChild(li);
    });
}

function deleteClass(id) {
    if (!confirm("Are you sure you want to delete this class?")) return;

    let classes = JSON.parse(localStorage.getItem("classes")) || [];
    classes = classes.filter(c => c.id !== id);
    localStorage.setItem("classes", JSON.stringify(classes));

    loadClasses();
}

function editClass(id) {
    const classes = JSON.parse(localStorage.getItem("classes")) || [];
    const selected = classes.find(c => c.id === id);

    const newName = prompt("Edit Class Name:", selected.name);
    if (!newName) return;

    selected.name = newName;
    localStorage.setItem("classes", JSON.stringify(classes));

    loadClasses();
}

function goHome() {
    window.location.href = "index.html";
}

function toggleDarkMode() {

    const body = document.body;

        if (body.classList.contains("dark")) {
            body.classList.remove("dark");
            body.classList.add("light");
            localStorage.setItem("theme", "light");
        } else {
            body.classList.remove("light");
            body.classList.add("dark");
            localStorage.setItem("theme", "dark");
        }
    }

    function loadTheme() {
        const theme = localStorage.getItem("theme") || "light";
        document.body.classList.add(theme);
    }

loadTheme();

loadClasses();
</script>

</body>
</html>