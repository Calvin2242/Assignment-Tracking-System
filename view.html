<!DOCTYPE HTML>
<html>
<head>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="mystyle.css">
    <title>View Assignments</title>
</head>

<body>

<header>
    <div class="logo-container">
        <img src="logo.png" alt="School Logo" class="school-logo">
    </div>

    <h1>All Assignments</h1>

    <button onclick="toggleDarkMode()">ðŸŒ™</button>
</header>

<section>

    <h3>Search Assignments</h3>

    <input type="text"
           id="searchInput"
           placeholder="Search by class, subject or assignment..."
           onkeyup="searchAssignments()">

    <br><br>

    <table id="assignmentTable">
        <tr>
            <th>Class</th>
            <th>Subject</th>
            <th>Assignment</th>
            <th>Progress</th>
            <th>Actions</th>
        </tr>
    </table>

    <br>
    <button onclick="goHome()">Back to Home</button>

</section>

<script>

const assignments = JSON.parse(localStorage.getItem("assignments")) || [];

function displayAssignments(list) {
    const table = document.getElementById("assignmentTable");

    table.innerHTML = `
        <tr>
            <th>Class</th>
            <th>Subject</th>
            <th>Assignment</th>
            <th>Progress</th>
            <th>Actions</th>
        </tr>
    `;

    if (list.length === 0) {
        const row = table.insertRow();
        row.innerHTML = `<td colspan="5">No assignments found.</td>`;
        return;
    }

    list.forEach(a => {

        const submittedCount = a.students.filter(s => s.submitted).length;
        const total = a.students.length;
        const progressPercent = total === 0 ? 0 :
            Math.round((submittedCount / total) * 100);

        const row = table.insertRow();

        row.innerHTML = `
            <td>${a.className}</td>
            <td>${a.subject}</td>
            <td>${a.title}</td>

            <td>
                ${submittedCount}/${total} (${progressPercent}%)

                <div class="progress-container">
                    <div class="progress-bar"
                         style="width:${progressPercent}%;">
                    </div>
                </div>
            </td>

            <td>
                <button onclick="editAssignment('${a.id}')">Edit</button>
                <button onclick="generateReport('${a.id}')">Report</button>
                <button class="danger"
                        onclick="deleteAssignment('${a.id}')">
                        Delete
                </button>
            </td>
        `;
    });
}

function searchAssignments() {
    const keyword = document.getElementById("searchInput").value.toLowerCase();

    const filtered = assignments.filter(a =>
        a.title.toLowerCase().includes(keyword) ||
        a.className.toLowerCase().includes(keyword) ||
        a.subject.toLowerCase().includes(keyword)
    );

    displayAssignments(filtered);
}

function editAssignment(id) {
    window.location.href = `assignment.html?id=${id}`;
}

function generateReport(id) {
    window.location.href = `report.html?id=${id}`;
}

function deleteAssignment(id) {
    if (!confirm("Are you sure you want to delete this assignment?")) return;

    let updatedAssignments = assignments.filter(a => a.id !== id);
    localStorage.setItem("assignments", JSON.stringify(updatedAssignments));

    location.reload();
}

function goHome() {
    window.location.href = "index.html";
}

function toggleDarkMode() {
    const body = document.body;

    if (body.classList.contains("dark")) {
        body.classList.remove("dark");
        body.classList.add("light");
        localStorage.setItem("theme", "light");
    } else {
        body.classList.remove("light");
        body.classList.add("dark");
        localStorage.setItem("theme", "dark");
    }
}

function loadTheme() {
    const theme = localStorage.getItem("theme") || "light";
    document.body.classList.add(theme);
}

loadTheme();
displayAssignments(assignments);

</script>

</body>
</html>